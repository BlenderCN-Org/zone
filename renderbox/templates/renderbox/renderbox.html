{% extends 'base.html' %}
{% block content %}
    <style>
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .x.axis path {
            display: none;
        }

        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 1.5px;
        }
    </style>
    <div class="content-wrapper">
        <!-- Main content -->
        <section class="content">
            <!-- Custom Tabs (Pulled to the right) -->
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs pull-right">
                    <li><a style="color: #d50363" href="#reports_tab" data-toggle="tab"><i class="fa fa-bar-chart"></i>
                        Reports</a></li>
                    <li><a style="color: #007bd5" href="#farm_tab" data-toggle="tab"><i class="fa fa-server"></i> View
                        Farm</a></li>
                    <li class="active"><a style="color: #d56600" href="#jobs_tab" data-toggle="tab"><i
                            class="fa fa-tasks"></i> View Jobs</a></li>
                    <li class="dropdown">
                        <a style="color: #18a600" class="dropdown-toggle" data-toggle="dropdown" href="#"><i
                                class="fa fa-rocket"></i>
                            Submit Job <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><img
                                    src="/media/icons/apps/maya.png" width="20" height="20"> Maya Job</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><img
                                    src="/media/icons/apps/houdini.png" width="20" height="20"> Houdini Job</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><img
                                    src="/media/icons/apps/blender.png" width="22" height="22"> Blender Job</a></li>
                            <li role="presentation" class="divider"></li>
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><img
                                    src="/media/icons/apps/nuke.png" width="20" height="20"> Nuke</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><img
                                    src="/media/icons/apps/afx.png" width="20" height="20"> After Effects</a></li>
                        </ul>
                    <li class="pull-left header"><img src="/media/icons/apps/box.ico" width="48" height="48"> RenderBOX
                        2.0
                    </li>
                </ul>

                <div class="tab-content">
                    <!-- / Jobs tab-pane -->
                    <div class="tab-pane active" id="jobs_tab">
                        <div class="row">
                            <div class="col-lg-7">
                                <div class="box">
                                    <div class="box-header">
                                        <h3 class="box-title">View Jobs</h3>
                                    </div>
                                    <!-- /.box-header -->
                                    <div class="box-body">
                                        <table id="jobs_table" class="table table-bordered table-striped">
                                            <thead>
                                            <tr>
                                                <th>Department</th>
                                                <th>Group</th>
                                                <th>Category</th>
                                                <th>Name</th>
                                                <th>Comment</th>
                                                <th>Status</th>
                                                <th>Priority</th>
                                                <th>App</th>
                                                <th>Start Frame</th>
                                                <th>End Frame</th>
                                                <th>Start Time</th>
                                                <th>End Time</th>
                                                <th>Submit by</th>
                                                <th>Submit Time</th>
                                                <th>Submit PC</th>
                                            </tr>
                                            </thead>
                                            <tfoot>
                                            <tr>
                                                <th>Department</th>
                                                <th>Group</th>
                                                <th>Category</th>
                                                <th>Name</th>
                                                <th>Comment</th>
                                                <th>Status</th>
                                                <th>Priority</th>
                                                <th>App</th>
                                                <th>Start Frame</th>
                                                <th>End Frame</th>
                                                <th>Start Time</th>
                                                <th>End Time</th>
                                                <th>Submit by</th>
                                                <th>Submit Time</th>
                                                <th>Submit PC</th>
                                            </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                    <!-- /.box-body -->
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="box box-info">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">Preview</h3>
                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="box-body chart-responsive">
                                        <img id="preview_img" src="/media/icons/default/preview.jpg" width="640"
                                             height="360">
                                    </div>
                                    <!-- /.box-body -->
                                </div>
                                <div class="box box-info">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">Selected Job Progress </h3>
                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="box-body chart-responsive">
                                        <canvas id="selected-job-canvas"></canvas>
                                    </div>
                                    <!-- /.box-body -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- /Farm tab-pane -->
                    <div class="tab-pane" id="farm_tab">
                        <div class="row">
                            <div class="col-lg-7">
                                <div class="box">
                                    <div class="box-header">
                                        <h3 class="box-title">View Render Farm</h3>
                                    </div>
                                    <!-- /.box-header -->
                                    <div class="box-body">
                                        <table id="farm_table" class="table table-hover table-responsive">
                                            <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>DESCRIPTION</th>
                                                <th>STATUS</th>
                                                <th>PLATFORM</th>
                                                <th>OS</th>
                                                <th>USERNAME</th>
                                                <th>ARCH</th>
                                                <th>HOSTNAME</th>
                                                <th>IDLE TIME</th>
                                                <th>RENDERING TIME</th>
                                                <th>UP TIME</th>
                                                <th>CPU</th>
                                                <th>CPU CORE</th>
                                                <th>L2 CACHE</th>
                                                <th>L3 CACHE</th>
                                                <th>CPU USAGE</th>
                                                <th>TOTAL RAM</th>
                                                <th>RAM USED</th>
                                                <th>IDLE RAM</th>
                                                <th>GPU CARD</th>
                                                <th>GPU MEMORY</th>
                                                <th>NETWORK SPEED</th>
                                                <th>IP</th>
                                                <th>MAC</th>
                                                <th>REGISTER TIME</th>
                                                <th>SYNC INTERVAL</th>
                                            </tr>
                                            </thead>

                                        </table>
                                    </div>
                                    <!-- /.box-body -->
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="box box-info">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">Client Resource Usages</h3>
                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="box-body chart-responsive">
                                        <canvas id="client_resource_usage_canvas"></canvas>
                                    </div>
                                    <!-- /.box-body -->
                                </div>
                                <div class="box box-info">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">Task Running on - 192.168.4.575 </h3>
                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="box-body chart-responsive">
                                        <table id="client_task_table" class="table table-bordered table-striped">
                                            <thead>
                                            <tr>
                                                <th>Rendering engine</th>
                                                <th>Browser</th>
                                                <th>Platform(s)</th>
                                                <th>Engine version</th>
                                                <th>CSS grade</th>
                                            </tr>
                                            </thead>

                                            <tfoot>
                                            <tr>
                                                <th>Rendering engine</th>
                                                <th>Browser</th>
                                                <th>Platform(s)</th>
                                                <th>Engine version</th>
                                                <th>CSS grade</th>
                                            </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                    <!-- /.box-body -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- /Reports tab-pane -->
                    <div class="tab-pane" id="reports_tab">
                        <div class="row">
                            <div class="col-xs-12">
                                <!-- interactive chart -->
                                <div class="box box-primary">
                                    <div class="box-header with-border">
                                        <i class="fa fa-bar-chart-o"></i>

                                        <h3 class="box-title">Render Farm Usage</h3>

                                        <div class="box-tools pull-right">
                                            Real time
                                            <div class="btn-group" id="realtime" data-toggle="btn-toggle">
                                                <button type="button" class="btn btn-default btn-xs active"
                                                        data-toggle="on">On
                                                </button>
                                                <button type="button" class="btn btn-default btn-xs" data-toggle="off">
                                                    Off
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div id="interactive" style="width: 100%; height: 300px;"></div>
                                    </div>
                                    <!-- /.box-body-->
                                </div>
                                <!-- /.box -->
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->
                        <div class="row">
                            <div class="col-md-6">
                                <!-- Line chart -->
                                <div class="box box-primary">
                                    <div class="box-header with-border">
                                        <i class="fa fa-bar-chart-o"></i>

                                        <h3 class="box-title">Jobs Status</h3>

                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i>
                                            </button>
                                            <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                                    class="fa fa-times"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <canvas id="jobs-chart-area"/>
                                    </div>
                                    <!-- /.box-body-->
                                </div>
                                <!-- /.box -->

                                <!-- Area chart -->
                                <div class="box box-primary">
                                    <div class="box-header with-border">
                                        <i class="fa fa-bar-chart-o"></i>

                                        <h3 class="box-title">Full Width Area Chart</h3>

                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i>
                                            </button>
                                            <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                                    class="fa fa-times"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div id="area-chart" style="height: 338px;" class="full-width-chart"></div>
                                    </div>
                                    <!-- /.box-body-->
                                </div>
                                <!-- /.box -->

                            </div>
                            <!-- /.col -->

                            <div class="col-md-6">
                                <!-- Bar chart -->
                                <div class="box box-primary">
                                    <div class="box-header with-border">
                                        <i class="fa fa-bar-chart-o"></i>

                                        <h3 class="box-title">Bar Chart</h3>

                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i>
                                            </button>
                                            <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                                    class="fa fa-times"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div id="bar-chart" style="height: 300px;"></div>
                                    </div>
                                    <!-- /.box-body-->
                                </div>
                                <!-- /.box -->

                                <!-- Donut chart -->
                                <div class="box box-primary">
                                    <div class="box-header with-border">
                                        <i class="fa fa-bar-chart-o"></i>

                                        <h3 class="box-title">Donut Chart</h3>

                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i>
                                            </button>
                                            <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                                    class="fa fa-times"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div id="donut-chart" style="height: 300px;"></div>
                                    </div>
                                    <!-- /.box-body-->
                                </div>
                                <!-- /.box -->
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->
                    </div>
                </div>
            </div>
        </section>
    </div>



    <script>
        var selected_job_config = {
            type: 'line',
            {#            here LABLE is frame and DATA is time #}
            data: {
                labels: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                datasets: [{
                    label: "1080 Frame Render",
                    backgroundColor: window.chartColors.red,
                    borderColor: window.chartColors.red,
                    data: [5, 7, 2, 6, 8, 7, 4, 3, 2, 1],
                    fill: false,
                }, {
                    label: "540 Frame Render",
                    fill: false,
                    backgroundColor: window.chartColors.blue,
                    borderColor: window.chartColors.blue,
                    data: [2, 5, 1, 4, 7, 3, 3, 1, 1, 1],
                }]
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: 'Job Name : Seq061_Sh245_Lit_V005'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Frame'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Render Time (Min)'
                        }
                    }]
                }
            }
        };
        var jobs_report_pie_config = {
            type: 'pie',
            data: {
                datasets: [{
                    data: [
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                        randomScalingFactor(),
                    ],
                    backgroundColor: [
                        window.chartColors.red,
                        window.chartColors.orange,
                        window.chartColors.yellow,
                        window.chartColors.green,
                        window.chartColors.blue,
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    "Red",
                    "Orange",
                    "Yellow",
                    "Green",
                    "Blue"
                ]
            },
            options: {
                responsive: true
            }
        };
        var client_resource_config = {
            type: 'line',
            data: {
                labels: Array.from(Array(8).keys()), // create a array with numbers [1,2,3,4,5....10]
                datasets: [{
                    label: "CPU usage",
                    borderColor: window.chartColors.red,
                    backgroundColor: window.chartColors.red,
                    data: [15, 40, 65, 40, 29, 55, 64, 26, 15],
                    fill: false
                }, {
                    label: "RAM usage",
                    borderColor: window.chartColors.blue,
                    backgroundColor: window.chartColors.blue,
                    data: [15, 12, 14, 18, 40, 35, 25, 13, 45],
                    fill: false
                }, {
                    label: "LAN usage",
                    borderColor: window.chartColors.green,
                    backgroundColor: window.chartColors.green,
                    data: [15, 16, 15, 11, 19, 75, 66, 46, 12],
                    fill: false
                }]
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: "Host Name - ELITEBOOK"
                },
                tooltips: {
                    mode: 'index',
                },
                hover: {
                    mode: 'index'
                },
                scales: {
                    xAxes: [{
                        display: false,
                        scaleLabel: {
                            display: true,
                            labelString: '60 Seconds'
                        }
                    }],
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: '% Utilization'
                        },
                        ticks: {
                            min: 0,
                            max: 100,
                            stepSize: 20
                        }
                    }]
                }
            }
        };
        window.onload = function () {
            var selected_job_line_chart = document.getElementById("selected-job-canvas").getContext("2d");
            window.myLine = new Chart(selected_job_line_chart, selected_job_config);
            var jobs_report_pie = document.getElementById("jobs-chart-area").getContext("2d");
            window.myPie = new Chart(jobs_report_pie, jobs_report_pie_config);
            var client_resource_usage = document.getElementById("client_resource_usage_canvas").getContext("2d");
            window.myLine = new Chart(client_resource_usage, client_resource_config);

        };
        $(function () {
            $('#jobs_table').DataTable();
            $('#client_task_table').DataTable();


            var all_clients_url = "/api/renderbox/client/?format=json";
            var farm_table = $('#farm_table').DataTable({
                dom: 'Blfrtip',
                stateSave: true,
                responsive: true,
                bPaginate: false,
                buttons: [
                    {extend: 'colvis', text: 'Filters ', className: 'btn btn-info btn-outline btn-small'}
                ],
                ajax: {
                    url: all_clients_url,
                    dataSrc: ''
                },
                columns: [
                    {"data": "id", "visible": true},
                    {"data": "description", "visible": true},

                    {
                        "data": "status", "class": "v-a-m ", "render": function (status, type, row) {
                            console.log(status);
                            return `<div class="media media-auto">
                                        <div class="media-left">
                                            <div class="avatar">
                                                <img width=25 height=25
                                                     src=${ status.icon }
                                                     alt=${ status.name }
                                                     title=${ status.name }>
                                            </div>
                                        </div>
                                       <div class="media-body">
                                            <span class="media-heading">${ status.name }</span>
                                        </div>
                                    </div>`;
                        }
                    },


                    {"data": "os_platform", "visible": true},
                    {"data": "os_name", "visible": false},
                    {"data": "os_username", "visible": false},
                    {"data": "os_arch", "visible": false},
                    {"data": "host_name", "visible": false},
                    {"data": "idle_time", "visible": false},
                    {"data": "rendering_time", "visible": false},
                    {"data": "up_time", "visible": true},
                    {"data": "cpu_name", "visible": false},
                    {"data": "cpu_core", "visible": false},
                    {"data": "l2_cache", "visible": false},
                    {"data": "l3_cache", "visible": false},
                    {"data": "cpu_usage", "visible": false},
                    {"data": "total_ram", "visible": false},
                    {"data": "ram_usage", "visible": false},
                    {"data": "available_ram", "visible": false},
                    {"data": "gpu_card", "visible": false},
                    {"data": "gpu_memory", "visible": false},
                    {"data": "network_speed", "visible": false},
                    {"data": "ip_address", "visible": false},
                    {"data": "mac_address", "visible": false},
                    {"data": "client_register_time", "visible": false},
                    {"data": "sync_interval", "visible": false},

                ]

            });


            /* Flot Interactive Chart*/
            // We use an inline data source in the example, usually data would
            // be fetched from a server
            var data = [], totalPoints = 100;

            function getRandomData() {
                if (data.length > 0)
                    data = data.slice(1);
                // Do a random walk
                while (data.length < totalPoints) {
                    var prev = data.length > 0 ? data[data.length - 1] : 50,
                        y = prev + Math.random() * 10 - 5;
                    if (y < 0) {
                        y = 0
                    } else if (y > 100) {
                        y = 100
                    }
                    data.push(y)
                }

                // Zip the generated y values with the x values
                var res = [];
                for (var i = 0; i < data.length; ++i) {
                    res.push([i, data[i]])
                }

                return res
            }

            var interactive_plot = $.plot('#interactive', [getRandomData()], {
                grid: {
                    borderColor: '#f3f3f3',
                    borderWidth: 1,
                    tickColor: '#f3f3f3'
                },
                series: {
                    shadowSize: 0, // Drawing is faster without shadows
                    color: '#3c8dbc'
                },
                lines: {
                    fill: true, //Converts the line chart to area chart
                    color: '#3c8dbc'
                },
                yaxis: {
                    min: 0,
                    max: 100,
                    show: true
                },
                xaxis: {
                    show: true
                }
            });
            var updateInterval = 500;//Fetch data ever x milliseconds
            var realtime = 'on';//If == to on then fetch data every x seconds. else stop fetching
            function update() {
                interactive_plot.setData([getRandomData()]);
                // Since the axes don't change, we don't need to call plot.setupGrid()
                interactive_plot.draw();
                if (realtime === 'on')
                    setTimeout(update, updateInterval)
            }

            //INITIALIZE REALTIME DATA FETCHING
            if (realtime === 'on') {
                update()
            }
            //REALTIME TOGGLE
            $('#realtime .btn').click(function () {
                if ($(this).data('toggle') === 'on') {
                    realtime = 'on'
                }
                else {
                    realtime = 'off'
                }
                update()
            })
            /* END INTERACTIVE CHART */
        })
    </script>


{% endblock content %}